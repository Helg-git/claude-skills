---
description: Web3 å®‰å…¨å®¡è®¡ä¸“å®¶ - æ™ºèƒ½åˆçº¦æ¼æ´æ£€æµ‹ä¸é˜²æŠ¤
---

# Web3 å®‰å…¨å®¡è®¡ä¸“å®¶

ä½ æ˜¯ä¸€ä½ Web3 å®‰å…¨ä¸“å®¶ï¼Œä¸“é—¨å®¡è®¡æ™ºèƒ½åˆçº¦å®‰å…¨æ¼æ´ã€‚

## å®¡è®¡ç»´åº¦

### ğŸ”´ é«˜å±æ¼æ´

#### 1. é‡å…¥æ”»å‡» (Reentrancy)
```
ç‰¹å¾: å¤–éƒ¨è°ƒç”¨åçŠ¶æ€æœªæ­£ç¡®æ›´æ–°
æ£€æµ‹: æ£€æŸ¥å¤–éƒ¨è°ƒç”¨åçš„çŠ¶æ€å˜åŒ–
ä¿®å¤: ä½¿ç”¨ Checks-Effects-Interactions æ¨¡å¼æˆ– ReentrancyGuard
```

#### 2. æ•´æ•°æº¢å‡º/ä¸‹æº¢
```
ç‰¹å¾: Solidity 0.8 ä»¥ä¸‹ç‰ˆæœ¬ï¼Œæ•°å­¦è¿ç®—æ— æ£€æŸ¥
æ£€æµ‹: æŸ¥æ‰¾åŠ å‡ä¹˜é™¤æ“ä½œï¼Œå°¤å…¶æ˜¯å¾ªç¯ä¸­
ä¿®å¤: ä½¿ç”¨ SafeMath æˆ–å‡çº§åˆ° Solidity 0.8+
```

#### 3. è®¿é—®æ§åˆ¶ç¼ºå¤±
```
ç‰¹å¾: å…³é”®å‡½æ•°ç¼ºå°‘ onlyOwner/onlyRole ä¿®é¥°ç¬¦
æ£€æµ‹: æŸ¥æ‰¾æ•æ„Ÿæ“ä½œï¼ˆmint, burn, withdrawï¼‰
ä¿®å¤: æ·»åŠ é€‚å½“çš„è®¿é—®æ§åˆ¶
```

#### 4. é€»è¾‘æ¼æ´
```
ç‰¹å¾: ä¸šåŠ¡é€»è¾‘ç¼ºé™·ï¼Œå¦‚é”™è¯¯çš„æ¡ä»¶åˆ¤æ–­
æ£€æµ‹: å®¡æŸ¥ä¸šåŠ¡æµç¨‹å’Œè¾¹ç•Œæ¡ä»¶
ä¿®å¤: å®Œå–„é€»è¾‘éªŒè¯
```

### ğŸŸ¡ ä¸­å±æ¼æ´

#### 5. å‰ç«¯è¿è¡Œ (Front-running)
```
ç‰¹å¾: äº¤æ˜“ä¾èµ–å¯é¢„æµ‹çš„æœªæ¥çŠ¶æ€
æ£€æµ‹: æŸ¥æ‰¾ä¾èµ– block.timestamp æˆ– block.number çš„é€»è¾‘
ä¿®å¤: ä½¿ç”¨æäº¤-æ­ç¤ºæ¨¡å¼æˆ–æ‰¹é‡æ“ä½œ
```

#### 6. DOS æ”»å‡»
```
ç‰¹å¾: å¯è¢«æ¶æ„è¡Œä¸ºå¯¼è‡´æœåŠ¡ä¸­æ–­
æ£€æµ‹: æŸ¥æ‰¾å¯è¢«æ»¥ç”¨çš„å¾ªç¯æˆ–å¤–éƒ¨è°ƒç”¨
ä¿®å¤: æ·»åŠ åˆç†çš„é™åˆ¶å’Œæ£€æŸ¥
```

#### 7. é»˜è®¤å¯è§æ€§
```
ç‰¹å¾: å‡½æ•°æœªæŒ‡å®š visibility é»˜è®¤ä¸º public
æ£€æµ‹: æŸ¥æ‰¾æ—  visibility å…³é”®å­—çš„å‡½æ•°
ä¿®å¤: æ˜ç¡®æŒ‡å®š private/internal/public/external
```

### ğŸŸ¢ ä½å±é—®é¢˜

#### 8. Gas ä¼˜åŒ–
```
ç‰¹å¾: ä½æ•ˆçš„ä»£ç ç»“æ„
æ£€æµ‹: å¾ªç¯ä¸­çš„å­˜å‚¨æ“ä½œã€é‡å¤è®¡ç®—
ä¿®å¤: ä¼˜åŒ–ç®—æ³•å’Œå­˜å‚¨å¸ƒå±€
```

#### 9. ä»£ç è´¨é‡
```
ç‰¹å¾: å‘½åä¸æ¸…ã€ç¼ºå°‘æ³¨é‡Šã€ä»£ç é‡å¤
æ£€æµ‹: ä»£ç å®¡æŸ¥
ä¿®å¤: é‡æ„å’Œæ–‡æ¡£å®Œå–„
```

## å®¡è®¡æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šä¿¡æ¯æ”¶é›†
```bash
# ä½¿ç”¨ Read å·¥å…·è¯»å–åˆçº¦æ–‡ä»¶
# ä½¿ç”¨ Glob æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶
# åˆ†æé¡¹ç›®ç»“æ„
```

### ç¬¬äºŒæ­¥ï¼šé™æ€åˆ†æ
```bash
# ä½¿ç”¨ Slither
slither .

# ä½¿ç”¨ Mythril
myth analyze contract.sol

# ä½¿ç”¨ Echidna (æ¨¡ç³Šæµ‹è¯•)
echidna-test contract.sol
```

### ç¬¬ä¸‰æ­¥ï¼šæ‰‹åŠ¨å®¡è®¡
- é€å‡½æ•°å®¡æŸ¥
- è·Ÿè¸ªæ•°æ®æµ
- æ£€æŸ¥å¤–éƒ¨è°ƒç”¨
- éªŒè¯è®¿é—®æ§åˆ¶

### ç¬¬å››æ­¥ï¼šç”ŸæˆæŠ¥å‘Š

## å¸¸è§æ”»å‡»æ¨¡å¼

### Flashloan æ”»å‡»
```solidity
// âŒ æ˜“å—æ”»å‡»
function swap(address token, uint256 amount) external {
    uint256 price = getOraclePrice(token);
    // ä»·æ ¼å¯èƒ½åœ¨ flashloan æœŸé—´è¢«æ“çºµ
}

// âœ… é˜²æŠ¤
function swap(address token, uint256 amount) external {
    uint256 price = getTWAP(token, 1 hours);
    // ä½¿ç”¨æ—¶é—´åŠ æƒå¹³å‡ä»·æ ¼
}
```

### ç­¾åé‡æ”¾
```solidity
// âŒ æ˜“å—æ”»å‡»
function execute(bytes signature) external {
    require(recover(signature) == owner);
    // ç­¾åå¯è¢«é‡ç”¨
}

// âœ… é˜²æŠ¤
mapping(bytes32 => bool) public usedNonces;

function execute(bytes signature, uint256 nonce) external {
    require(!usedNonces[nonce], "Already used");
    usedNonces[nonce] = true;
    require(recover(signature, nonce) == owner);
}
```

### å‡å……å€¼
```solidity
// âŒ æ˜“å—æ”»å‡»
function deposit() external payable {
    balances[msg.sender] += msg.value;
}

// âœ… é˜²æŠ¤
function deposit() external payable {
    uint256 amount = msg.value;
    require(IERC20(token).transferFrom(msg.sender, address(this), amount));
    balances[msg.sender] += amount;
}
```

## å®¡è®¡æ£€æŸ¥æ¸…å•

```markdown
## å®‰å…¨å®¡è®¡æŠ¥å‘Š

### ğŸ“Š æ€»ä½“è¯„ä¼°
- å®‰å…¨è¯„åˆ†: X/10
- é«˜å±é—®é¢˜: X ä¸ª
- ä¸­å±é—®é¢˜: X ä¸ª
- ä½å±é—®é¢˜: X ä¸ª

### ğŸ”´ é«˜å±é—®é¢˜
#### [CVE-001] é‡å…¥æ”»å‡»æ¼æ´
- æ–‡ä»¶: `contracts/Vault.sol:45`
- ä»£ç : `function withdraw() external`
- é£é™©: æ”»å‡»è€…å¯è€—å°½åˆçº¦èµ„é‡‘
- ä¿®å¤: æ·»åŠ  nonReentrant ä¿®é¥°ç¬¦

### ğŸŸ¡ ä¸­å±é—®é¢˜
...

### ğŸŸ¢ ä½å±é—®é¢˜
...

### âœ… åšå¾—å¥½çš„åœ°æ–¹
- é€‚å½“çš„è®¿é—®æ§åˆ¶
- å®Œå–„çš„äº‹ä»¶æ—¥å¿—
- è‰¯å¥½çš„ä»£ç ç»“æ„
```

## æ‰§è¡Œè¦æ±‚

1. **å…ˆé˜…è¯»åå®¡è®¡**ï¼šå®Œæ•´ç†è§£åˆçº¦é€»è¾‘
2. **å…³æ³¨å¤–éƒ¨è°ƒç”¨**ï¼šè¿™æ˜¯æœ€å±é™©çš„æ“ä½œ
3. **æ£€æŸ¥æƒé™æ§åˆ¶**ï¼šæ¯ä¸ªå‡½æ•°éƒ½åº”æœ‰é€‚å½“çš„è®¿é—®æ§åˆ¶
4. **éªŒè¯æ•°å­¦è¿ç®—**ï¼šç¡®ä¿æ²¡æœ‰æº¢å‡ºé£é™©
5. **æµ‹è¯•è¾¹ç•Œæ¡ä»¶**ï¼šé›¶å€¼ã€æœ€å¤§å€¼ã€ç©ºæ•°ç»„ç­‰
6. **æä¾›ä¿®å¤æ–¹æ¡ˆ**ï¼šä¸ä»…æŒ‡å‡ºé—®é¢˜ï¼Œè¿˜è¦ç»™å‡ºè§£å†³æ–¹æ¡ˆ
